*, *::before, *::after { box-sizing:border-box; margin:0; padding:0; }
:root { --cream:#f5f0e8; --warm:#e8dcc8; --brown:#5c3d2e; --gold:#c9a84c;
        --fd:.7s; --fe:cubic-bezier(.42,0,.2,1); }

body {
  min-height:100dvh;
  background:radial-gradient(ellipse at 50% 60%,#3a2510 0%,#150a03 100%);
  display:grid; place-items:center;
  font-family:'Lato',sans-serif; overflow:hidden; user-select:none;
}
h1 {
  position:fixed; left:50%; transform:translateX(-50%);
  white-space:nowrap;
  font-family:'Playfair Display',serif; color:var(--gold);
  font-size:1.1rem; letter-spacing:0.2em;
  text-transform:uppercase; opacity:0.8;
  z-index:10;
}

/* ── BOOK ── */
.book-wrap { position:relative; width:min(1000px,78vw); height:min(630px,49vw); }
.book-wrap::after {
  content:''; position:absolute; bottom:-16px; left:8%; right:8%; height:28px;
  background:radial-gradient(ellipse,rgba(0,0,0,.55) 0%,transparent 70%);
  pointer-events:none;
}
.book { position:relative; width:100%; height:100%; perspective:3000px; }

.spread {
  position:absolute; inset:0; display:flex;
  border-radius:10px; overflow:hidden;
  box-shadow:-4px 4px 30px rgba(0,0,0,.5),4px 4px 30px rgba(0,0,0,.4);
}
.page {
  flex:1; position:relative; overflow:hidden;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  padding:22px 16px 16px;
}
.page.left-page  { background:linear-gradient(to right,#ddd4be,var(--cream)); border-right:1px solid rgba(100,70,30,.12); }
.page.right-page { background:linear-gradient(to left,#ddd4be,var(--cream)); }
.page.left-page::after  { content:''; position:absolute; right:0;top:0;bottom:0;width:22px; background:linear-gradient(to left,rgba(0,0,0,.09),transparent); pointer-events:none; }
.page.right-page::before{ content:''; position:absolute; left:0;top:0;bottom:0;width:22px; background:linear-gradient(to right,rgba(0,0,0,.06),transparent); pointer-events:none; }

.spine-line {
  position:absolute; top:0;bottom:0; left:50%; transform:translateX(-50%);
  width:3px; z-index:5; pointer-events:none;
  background:linear-gradient(to bottom,#c4a97a,#7a5c38,#c4a97a);
  box-shadow:0 0 6px rgba(0,0,0,.3);
}
.pg-num { position:absolute; bottom:7px; font-size:.58rem; color:#b09070; letter-spacing:.1em; }
.left-page  .pg-num { left:14px; }
.right-page .pg-num { right:14px; }

/* ── COVER ── */
.cover-l { background:linear-gradient(160deg,#f0ebe2,#e5dece)!important; align-items:center; justify-content:center; }
.cover-l::before {
  content:''; position:absolute; inset:0; pointer-events:none; z-index:0;
  background-image:url('paper_texture2.png');
  background-size:cover; background-position:center;
  mix-blend-mode:multiply; opacity:.6;
}
.cover-r { background:linear-gradient(135deg,#5a2e10,#2e1508)!important; flex-direction:column; align-items:center; justify-content:center; gap:16px; padding:20px 16px; will-change:transform; transform:translateZ(0); backface-visibility:hidden; }
.cover-r h2 { font-family:'Playfair Display',serif; color:var(--gold); font-size:1.8rem; text-align:center; line-height:1.2; word-break:break-word; }
.cover-r p  { color:rgba(201,168,76,.55); font-size:.72rem; letter-spacing:.25em; text-transform:uppercase; }
.cover-divider { width:44px; height:1px; background:var(--gold); opacity:.5; }

/* cover photo slot (centered thumbnail above title) */
.cover-photo-slot {
  width:68%; aspect-ratio:1; flex-shrink:0;
  position:relative; overflow:hidden; border-radius:6px;
  transform:translateZ(0); will-change:transform;
  backface-visibility:hidden; -webkit-backface-visibility:hidden;
  transform-style:preserve-3d;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  cursor:pointer;
}
.cover-photo-slot:not(.has-photo) {
  border:2px dashed rgba(150,110,70,.3);
  background:rgba(255,255,255,.03);
}
.cover-photo-slot:not(.has-photo):hover { background:rgba(180,150,110,.1); border-color:rgba(201,168,76,.5); }
.cover-photo-slot img { position:absolute; left:50%; top:50%;
  width:100%; height:100%; object-fit:cover; display:block;
  will-change:transform; backface-visibility:hidden; -webkit-backface-visibility:hidden;
  image-rendering:auto; }
/* Hover zoom on wrap (same pattern as regular photo slots) */
.cover-photo-slot.has-photo:hover .photo-crop-wrap,
.cover-photo-slot.has-photo:focus-within .photo-crop-wrap,
.cover-photo-slot.has-photo.photo-active .photo-crop-wrap { transform:scale(1.03); }
.cover-photo-slot.has-photo {
  border:1.5px solid rgba(201,168,76,.32);
  box-shadow:inset 0 2px 10px rgba(0,0,0,.22), 0 3px 12px rgba(0,0,0,.28);
  transition:border-color .2s, box-shadow .2s;
}
.cover-photo-slot.has-photo::after {
  content:''; position:absolute; inset:0; pointer-events:none; z-index:2; border-radius:inherit;
  background:linear-gradient(152deg, rgba(255,255,255,.09) 0%, transparent 48%);
}
.cover-photo-slot.has-photo:hover {
  border-color:rgba(201,168,76,.6);
  box-shadow:inset 0 2px 12px rgba(0,0,0,.26), 0 5px 20px rgba(0,0,0,.38);
}
.cover-photo-slot .add-icon  { font-size:1.4rem; color:rgba(150,110,70,.45); pointer-events:none; }
.cover-photo-slot .add-label { font-size:.55rem; color:rgba(150,110,70,.38); margin-top:4px; letter-spacing:.09em; pointer-events:none; }
.cover-photo-slot input[type=file] { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; z-index:1; }
/* old .rm rules removed — replaced by .photo-hover-btns below */
.cover-photo-slot.converting::after {
  content:'Loading…'; position:absolute; inset:0; pointer-events:none;
  background:rgba(40,10,2,.75); display:flex; align-items:center; justify-content:center;
  color:var(--gold); font-size:.65rem; letter-spacing:.1em;
}
.cover-imprint {
  position:absolute; top:50%; left:0; right:0; transform:translateY(-50%); text-align:center;
  font-family:'Playfair Display',serif; font-style:italic;
  font-size:.82rem; letter-spacing:.22em; text-transform:uppercase;
  color:rgba(92,61,46,.65);
  background:transparent; border:none; outline:none; cursor:text; user-select:text;
  text-decoration:underline; text-decoration-color:transparent; transition:text-decoration-color .2s;
}
.cover-imprint:hover  { text-decoration-color:rgba(92,61,46,.22); }
.cover-imprint:focus  { text-decoration-color:transparent; outline:none; }
.cover-imprint:empty::before { content:attr(data-placeholder); color:rgba(92,61,46,.2); }
.cover-imprint:focus:empty::before { display:none; }
.cover-title {
  font-family:'Playfair Display',serif; font-size:1.8rem; line-height:1.2;
  color:var(--gold); background:transparent; border:none; outline:none;
  text-align:center; width:68%; padding:0; cursor:text;
  word-break:break-word; white-space:normal;
  text-decoration:underline; text-decoration-color:transparent;
  transition:text-decoration-color .2s; user-select:text;
}
.cover-title:hover  { text-decoration-color:rgba(201,168,76,.42); }
.cover-title:focus  { text-decoration-color:transparent; outline:none; }
.cover-title::after {
  content:' ✎'; font-size:.55em; vertical-align:.2em;
  color:rgba(201,168,76,.4); opacity:0; transition:opacity .18s;
}
.cover-title:hover::after,
.cover-title:focus::after { opacity:1; }
.cover-sub {
  font-family:'Lato',sans-serif; color:rgba(201,168,76,.55); font-size:.72rem;
  letter-spacing:.25em; text-transform:uppercase;
  background:transparent; border:none; outline:none;
  text-align:center; width:68%; padding:0; cursor:text;
  text-decoration:underline; text-decoration-color:transparent;
  transition:text-decoration-color .2s; user-select:text;
}
.cover-sub:hover { text-decoration-color:rgba(201,168,76,.38); }
.cover-sub:focus { text-decoration-color:transparent; outline:none; }

/* cover-field wraps the cover-sub input so ::after pencil works */
.cover-field { position:relative; width:68%; }
.cover-field .cover-sub { width:100%; }
.cover-field::after {
  content:'✎'; position:absolute; right:0; top:50%; transform:translateY(-50%);
  font-size:.6rem; color:rgba(201,168,76,.4); opacity:0; transition:opacity .18s; pointer-events:none;
}
.cover-field:hover::after,
.cover-field:focus-within::after { opacity:1; }

/* cover-imprint pencil (brown paper page, same pattern as cover-title) */
.cover-imprint::after {
  content:' ✎'; font-size:.55em; vertical-align:.2em;
  color:rgba(92,61,46,.45); opacity:0; transition:opacity .18s;
}
.cover-imprint:hover::after,
.cover-imprint:focus::after { opacity:1; }

/* ── PHOTO GRID LAYOUTS ── */
.photo-grid { display:grid; gap:6px; width:100%; flex:1; }
.photo-grid.single { grid-template-rows:1fr; }
.photo-grid.two    { grid-template-rows:1fr 1fr; }
.photo-grid.trio   { grid-template-rows:1fr 1fr; grid-template-columns:1fr 1fr; }
.photo-grid.trio .photo-slot:first-child { grid-column:1/-1; }
.photo-grid.quad   { grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr; min-height:0; }

.photo-slot {
  position:relative; overflow:hidden; border-radius:4px;
  border:2px dashed rgba(150,110,70,.3);
  background:rgba(180,150,110,.12);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  cursor:pointer; transition:background .2s,border-color .2s,box-shadow .2s; min-height:40px;
}
.photo-slot:hover { background:rgba(180,150,110,.22); border-color:var(--gold); }
.photo-slot.has-photo { border:none; }
.photo-slot.drag-over { box-shadow:0 0 0 3px var(--gold); border-color:var(--gold); background:rgba(201,168,76,.15); }
.photo-slot.drag-over::after {
  content:''; position:absolute; inset:0; pointer-events:none; z-index:5;
  background:rgba(0,0,0,.2);
  transition:background .12s;
}
.photo-slot img { position:absolute; left:50%; top:50%;
  width:100%; height:100%; object-fit:cover; display:block;
  will-change:transform; backface-visibility:hidden; }
/* Hover-zoom lives on the wrap so it composes cleanly with the crop inline transform */
.photo-crop-wrap { position:absolute; inset:0; overflow:hidden;
  transition:transform 200ms ease; }
.photo-slot.has-photo:hover .photo-crop-wrap,
.photo-slot.has-photo:focus-within .photo-crop-wrap,
.photo-slot.has-photo.photo-active .photo-crop-wrap { transform:scale(1.03); }
.photo-slot .add-icon  { font-size:1.3rem; color:rgba(150,110,70,.45); pointer-events:none; }
.photo-slot .add-label { font-size:.58rem; color:rgba(120,80,40,.45); margin-top:3px; letter-spacing:.07em; pointer-events:none; }
.photo-slot input[type=file] { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; z-index:1; }

/* ── PHOTO HOVER CONTROLS ── */
.photo-hover-overlay {
  position:absolute; inset:0; z-index:2; border-radius:inherit;
  background:rgba(0,0,0,0); pointer-events:none;
  transition:background 200ms ease;
}
.photo-slot.has-photo:hover .photo-hover-overlay,
.photo-slot.has-photo:focus-within .photo-hover-overlay,
.photo-slot.has-photo.photo-active .photo-hover-overlay,
.cover-photo-slot.has-photo:hover .photo-hover-overlay,
.cover-photo-slot.has-photo.photo-active .photo-hover-overlay { background:rgba(0,0,0,.14); }

.photo-hover-btns {
  position:absolute; top:6px; right:6px; z-index:5;
  display:flex; gap:5px;
  opacity:0; pointer-events:none;
  transition:opacity 200ms ease;
}
.photo-slot.has-photo:hover .photo-hover-btns,
.photo-slot.has-photo:focus-within .photo-hover-btns,
.photo-slot.has-photo.photo-active .photo-hover-btns,
.cover-photo-slot.has-photo:hover .photo-hover-btns,
.cover-photo-slot.has-photo.photo-active .photo-hover-btns { opacity:1; pointer-events:auto; }

.photo-btn {
  width:34px; height:34px;
  background:rgba(0,0,0,.28); border:1px solid rgba(201,168,76,.6);
  color:var(--gold); border-radius:10px; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  transition:background 150ms ease, border-color 150ms ease, box-shadow 150ms ease;
  flex-shrink:0;
}
.photo-btn:hover { background:rgba(0,0,0,.48); border-color:var(--gold); box-shadow:0 0 10px rgba(201,168,76,.28); }
.photo-btn:active { transform:scale(.92); }
/* drag handle on photos */
.photo-slot.has-photo { cursor:grab; }
.photo-slot.has-photo:active { cursor:grabbing; }
.photo-slot.dragging {
  opacity:.85; transform:scale(1.04); cursor:grabbing; z-index:10;
  box-shadow:0 10px 28px rgba(0,0,0,.5), 0 2px 8px rgba(0,0,0,.3);
}
@keyframes snapSettle { 0%{transform:scale(.97)} 100%{transform:scale(1)} }
.photo-slot.snap { animation:snapSettle 150ms cubic-bezier(.2,0,.38,1) forwards; }

.photo-slot.converting::after {
  content:'Loading…'; position:absolute; inset:0;
  background:rgba(245,240,232,.85); display:flex; align-items:center; justify-content:center;
  font-size:.68rem; color:var(--brown); letter-spacing:.08em; pointer-events:none;
}

.caption-wrap { width:100%; margin-top:6px; flex-shrink:0; position:relative; }
.caption-wrap::after {
  content:'✎'; position:absolute; right:2px; top:50%; transform:translateY(-50%);
  font-size:.6rem; color:rgba(150,100,60,.38); opacity:0; transition:opacity .18s; pointer-events:none;
}
.caption-wrap:hover::after,
.caption-wrap:focus-within::after { opacity:1; }
.caption-wrap input {
  width:100%; border:none; border-bottom:1px solid rgba(150,110,70,.25);
  background:transparent; font-family:'Playfair Display',serif; font-style:italic;
  font-size:.7rem; color:var(--brown); padding:2px; text-align:center; outline:none;
}
.caption-wrap input::placeholder { color:rgba(150,100,60,.35); }

/* ── LAYOUT PICKER ── */
.layout-bar {
  position:absolute; top:50%;
  display:flex; flex-direction:column; gap:4px; z-index:6; opacity:0; transition:opacity .2s;
  pointer-events:none;
}
.left-page  .layout-bar { left:4px;  transform:translateY(-50%); }
.right-page .layout-bar { right:4px; transform:translateY(-50%); }
.page:hover .layout-bar { opacity:1; pointer-events:all; }
.layout-btn {
  background:rgba(40,20,5,.75); border:1px solid rgba(201,168,76,.4);
  color:var(--gold); border-radius:4px; padding:4px;
  cursor:pointer; display:inline-flex; align-items:center; justify-content:center;
  transition:background .15s;
}
.layout-btn:hover  { background:rgba(201,168,76,.3); }
.layout-btn:active { background:rgba(201,168,76,.45); transform:scale(0.92); }
.layout-btn.active { background:rgba(201,168,76,.25); border-color:var(--gold); }

/* ── PAGE FLIP ── */
.flipper-container {
  position:absolute; top:0; bottom:0; width:50%;
  transform-style:preserve-3d; z-index:10; pointer-events:none;
}
.flipper-container.flip-forward  { right:0; transform-origin:left center;  animation:flipF var(--fd) var(--fe) forwards; }
.flipper-container.flip-backward { left:0;  transform-origin:right center; animation:flipB var(--fd) var(--fe) forwards; }
@keyframes flipF { from{transform:rotateY(0)} to{transform:rotateY(-180deg)} }
@keyframes flipB { from{transform:rotateY(0)} to{transform:rotateY(180deg)} }
.flip-mid-shadow {
  position:absolute; inset:0; pointer-events:none; z-index:8; opacity:0;
  background:linear-gradient(to right,transparent 38%,rgba(0,0,0,.09) 50%,transparent 62%);
}

.flipper-face {
  position:absolute; inset:0; backface-visibility:hidden; -webkit-backface-visibility:hidden;
  overflow:hidden; display:flex; flex-direction:column; align-items:center; justify-content:center;
  padding:22px 16px 16px;
}
.flip-forward  .face-front { border-radius:0 10px 10px 0; }
.flip-forward  .face-back  { border-radius:10px 0 0 10px; transform:rotateY(180deg); }
.flip-backward .face-front { border-radius:10px 0 0 10px; }
.flip-backward .face-back  { border-radius:0 10px 10px 0; transform:rotateY(-180deg); }
.flip-forward  .face-front::after, .flip-backward .face-front::after {
  content:''; position:absolute; inset:0; pointer-events:none; border-radius:inherit;
  background:linear-gradient(to left,rgba(0,0,0,.15) 0%,rgba(0,0,0,.04) 22%,transparent 55%);
}
.flip-forward  .face-back::after,  .flip-backward .face-back::after  {
  content:''; position:absolute; inset:0; pointer-events:none; border-radius:inherit;
  background:linear-gradient(to right,rgba(0,0,0,.11) 0%,rgba(0,0,0,.03) 22%,transparent 55%);
}

/* ── CONTROLS ── */
.controls {
  position:fixed; left:50%; transform:translateX(-50%);
  display:flex; align-items:center; gap:12px; flex-wrap:wrap; justify-content:center;
  z-index:20;
  opacity:0; pointer-events:none; transition:opacity .25s;
}
.btn {
  background:rgba(201,168,76,.12); border:1px solid rgba(201,168,76,.35);
  color:var(--gold); padding:8px 18px; border-radius:30px;
  font-family:'Lato',sans-serif; font-size:.72rem;
  letter-spacing:.12em; text-transform:uppercase;
  cursor:pointer; transition:background .2s,transform .1s;
}
.btn:hover { background:rgba(201,168,76,.25); transform:scale(1.04); }
.btn:disabled { opacity:.25; cursor:default; transform:none; }
.btn.add   { color:#85e89a; border-color:rgba(100,210,120,.35); background:rgba(80,180,100,.1); }
.btn.del   { color:#f08080; border-color:rgba(220,80,80,.35);   background:rgba(180,60,60,.1); }
.btn.tray  { color:#a0c8f0; border-color:rgba(100,160,220,.35); background:rgba(60,100,180,.1); }
.btn.reset  { color:#e8a060; border-color:rgba(232,160,96,.35);  background:rgba(200,120,40,.1); }
.btn.export { color:#90caf9; border-color:rgba(100,160,230,.35); background:rgba(60,110,200,.1); }
.btn.import { color:#a5d6a7; border-color:rgba(100,200,120,.35); background:rgba(60,160,80,.1); }
.pg-indicator { color:rgba(201,168,76,.55); font-size:.7rem; letter-spacing:.1em; min-width:80px; text-align:center; }
.hint { display:none; }
body.mode-open  .controls { opacity:1; pointer-events:auto; }
/* Read mode: hide all editor chrome except prev/next controls and tray button */
body.mode-read  .editor-only       { display:none; }
body.mode-read  h1.editor-only     { display:block; }
body.mode-read  .controls          { display:flex; opacity:1; pointer-events:auto; }
body.mode-read  .floating-tray-btn { display:flex; }
/* While still on closed cover in read mode, keep nav controls hidden */
body.mode-closed.mode-read .controls          { opacity:0; pointer-events:none; }
body.mode-closed.mode-read .floating-tray-btn { display:none; }

/* Read mode: no drag cursor or native img drag */
body.mode-read .photo-slot.has-photo  { cursor:default; }
/* Read mode: empty slots are clean silent frames */
body.mode-read .photo-slot:not(.has-photo) { border:none; cursor:default; background:rgba(180,150,110,.06); }
/* Read mode: suppress all pen icons and editable affordances */
body.mode-read .caption-wrap::after,
body.mode-read .cover-field::after,
body.mode-read .cover-title::after,
body.mode-read .cover-imprint::after { display:none; }
body.mode-read .caption-wrap input   { border-bottom:none; cursor:default; }
body.mode-read .cover-title,
body.mode-read .cover-sub            { text-decoration:none; cursor:default; }
body.mode-read .cover-imprint        { cursor:default; }

/* ── PAGE TRAY ── */
.tray-overlay {
  position:fixed; inset:0; background:rgba(0,0,0,.7);
  display:flex; align-items:flex-end; justify-content:center;
  z-index:100; opacity:0; pointer-events:none;
  transition:opacity .25s;
}
.tray-overlay.open { opacity:1; pointer-events:all; }
.tray {
  background:rgba(30,14,4,.95); border-top:1px solid rgba(201,168,76,.25);
  border-radius:16px 16px 0 0; padding:16px 16px 24px;
  width:100%; max-width:860px;
  transform:translateY(100%); transition:transform .3s cubic-bezier(.4,0,.2,1);
}
.tray-overlay.open .tray { transform:translateY(0); }
.tray-header {
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:14px;
}
.tray-header h3 { font-family:'Playfair Display',serif; color:var(--gold); font-size:.95rem; letter-spacing:.1em; }
.tray-close { background:none; border:none; color:rgba(201,168,76,.6); font-size:1.2rem; cursor:pointer; }
.tray-scroll { display:flex; gap:10px; overflow-x:auto; padding-bottom:8px; padding-top:6px; }
.tray-scroll::-webkit-scrollbar { height:4px; }
.tray-scroll::-webkit-scrollbar-thumb { background:rgba(201,168,76,.3); border-radius:2px; }

.tray-item {
  flex-shrink:0; width:90px; cursor:pointer;
  border-radius:6px; overflow:hidden;
  border:2px solid transparent;
  transition:border-color .2s, transform .15s;
  position:relative;
}
.tray-item:hover { transform:translateY(-3px); border-color:rgba(201,168,76,.5); }
.tray-item.current-tray { border-color:var(--gold); }
.tray-item.drag-tray-over { border-color:#85e89a; box-shadow:0 0 0 1px #85e89a; }
.tray-thumb {
  width:90px; height:60px; background:var(--cream);
  display:flex; overflow:hidden;
}
.tray-half { flex:1; position:relative; overflow:hidden; }
.tray-half img { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; }
.tray-half.dark { background:linear-gradient(135deg,#2e1508,#5a2e10); }
.tray-half.light-l { background:linear-gradient(to right,#ddd4be,var(--cream)); }
.tray-half.light-r { background:linear-gradient(to left, #ddd4be,var(--cream)); }
.tray-label { text-align:center; font-size:.58rem; color:rgba(201,168,76,.6); padding:4px 2px 2px; letter-spacing:.06em; }
.tray-drag-hint { font-size:.55rem; color:rgba(201,168,76,.35); text-align:center; margin-top:10px; letter-spacing:.08em; }
body.mode-read .tray-drag-hint { display:none; }
body.mode-read .tray-item { cursor:default; }

/* drag ghost style */
.tray-item.dragging-tray { opacity:.4; }
/* ── FLOATING ALL PAGES BUTTON ── */
.floating-tray-btn {
  position:absolute;
  top:0; right:-76px;
  width:42px;
  background:rgba(201,168,76,.12);
  border:1px solid rgba(201,168,76,.35);
  border-radius:8px;
  color:var(--gold);
  font-size:.62rem;
  letter-spacing:.08em;
  text-transform:uppercase;
  cursor:pointer;
  padding:8px 4px;
  display:flex; flex-direction:column; align-items:center; gap:5px;
  transition:background .2s, transform .15s;
  font-family:'Lato',sans-serif;
  line-height:1.3;
  text-align:center;
}
.floating-tray-btn:hover  { background:rgba(201,168,76,.25); transform:scale(1.06); }
.floating-tray-btn:active { transform:scale(0.97); }
.floating-tray-btn .tray-icon { font-size:1.2rem; }

/* ── ACTION RAIL ── */
.action-rail {
  position:absolute; top:50%; right:-76px;
  transform:translateY(-50%);
  display:flex; flex-direction:column; align-items:center; gap:8px;
  z-index:20;
}
/* Share button — pinned to bottom-right of book-wrap */
.share-btn {
  position:absolute; bottom:0; right:-76px;
  width:42px; height:42px;
  background:rgba(201,168,76,.12); border:1px solid rgba(201,168,76,.35);
  border-radius:8px; color:var(--gold); cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  transition:background .2s, transform .15s, box-shadow .15s;
  z-index:20;
}
.share-btn:hover  { background:rgba(201,168,76,.25); transform:scale(1.08); box-shadow:0 0 14px rgba(201,168,76,.2); }
.share-btn:active { transform:scale(0.94); }

/* ── SHARE MODAL ── */
.share-overlay {
  position:fixed; inset:0; z-index:200;
  background:rgba(10,5,2,.72); backdrop-filter:blur(4px);
  display:flex; align-items:center; justify-content:center;
  opacity:0; pointer-events:none; transition:opacity .2s;
}
.share-overlay.open { opacity:1; pointer-events:auto; }
.share-modal {
  background:linear-gradient(160deg,#2a1a0e,#1a0e06);
  border:1px solid rgba(201,168,76,.25); border-radius:14px;
  padding:32px 28px 28px; width:min(420px,90vw);
  display:flex; flex-direction:column; gap:16px;
  box-shadow:0 24px 60px rgba(0,0,0,.6);
  transform:translateY(10px); transition:transform .2s;
}
.share-overlay.open .share-modal { transform:translateY(0); }
.share-modal h2 {
  font-family:'Playfair Display',serif; color:var(--cream);
  font-size:1.15rem; font-weight:700; margin:0;
}
.share-url-row { display:flex; gap:8px; }
.share-url-row input {
  flex:1; background:rgba(255,255,255,.05); border:1px solid rgba(201,168,76,.22);
  border-radius:8px; color:rgba(232,220,200,.8); padding:9px 12px;
  font-size:.78rem; font-family:'Lato',sans-serif; letter-spacing:.02em;
  outline:none; cursor:default;
}
.share-url-row input.copyable { cursor:pointer; }
.share-copy-btn {
  background:rgba(201,168,76,.18); border:1px solid rgba(201,168,76,.45);
  border-radius:8px; color:var(--gold); padding:9px 16px;
  font-family:'Lato',sans-serif; font-size:.72rem; font-weight:700;
  letter-spacing:.1em; text-transform:uppercase; cursor:pointer;
  transition:background .18s, transform .12s; white-space:nowrap;
}
.share-copy-btn:not(:disabled):hover  { background:rgba(201,168,76,.32); transform:scale(1.04); }
.share-copy-btn:not(:disabled):active { transform:scale(.97); }
.share-copy-btn:disabled { opacity:.38; cursor:default; transform:none; }
.share-copy-btn.copied {
  color:#8fbc8f;
  background:rgba(100,160,100,.12);
  border-color:rgba(100,160,100,.4);
}
.share-helper { font-size:.65rem; color:rgba(201,168,76,.35); letter-spacing:.04em; transition:color .25s; }
.share-helper.confirmed { color:#8fbc8f; }
.share-close {
  position:absolute; top:14px; right:16px;
  background:none; border:none; color:rgba(201,168,76,.4);
  font-size:1rem; cursor:pointer; line-height:1;
}
.share-close:hover { color:var(--gold); }
.share-modal { position:relative; }
.rail-btn {
  width:42px; height:42px;
  background:rgba(201,168,76,.12); border:1px solid rgba(201,168,76,.35);
  border-radius:8px; color:var(--gold); font-size:1.15rem;
  cursor:pointer; display:flex; align-items:center; justify-content:center;
  transition:background .2s, transform .15s, box-shadow .15s;
}
.rail-btn:hover:not(:disabled) {
  background:rgba(201,168,76,.25); transform:scale(1.08);
  box-shadow:0 0 14px rgba(201,168,76,.2);
}
.rail-btn:active:not(:disabled) { transform:scale(0.94); box-shadow:none; }
.rail-btn:disabled { opacity:.25; cursor:default; }
#delBtn:hover:not(:disabled) { color:#f08080; border-color:rgba(220,80,80,.5); background:rgba(180,60,60,.15); box-shadow:0 0 14px rgba(200,60,60,.2); }
.rail-btn { position:relative; }
.rail-btn::after {
  content: attr(data-tooltip);
  position:absolute; left:calc(100% + 8px); top:50%; transform:translateY(-50%);
  background:rgba(20,8,2,.92); border:1px solid rgba(201,168,76,.3);
  color:var(--gold); font-size:.58rem; letter-spacing:.1em; text-transform:uppercase;
  white-space:nowrap; padding:4px 9px; border-radius:4px;
  pointer-events:none; opacity:0; transition:opacity .12s;
}
.rail-btn:hover::after { opacity:1; }

/* ── BOOK MODE TOGGLE ── */
body.mode-closed .editor-only:not(.controls) { display:none; }
body.mode-open   #closedView  { display:none; }
/* Spread is in DOM in closed mode for pre-rendering, but invisible */
body.mode-closed #book            { opacity:0; pointer-events:none; }
body.mode-closed .book-wrap::after{ opacity:0; }

/* ── CLOSED BOOK ── */
/* #closedView lives inside book-wrap (position:relative) as an absolute overlay */
#closedView {
  position:absolute; inset:0; z-index:5;
  display:flex; align-items:center; justify-content:center;
}
/* Half-width cover — centered by flex parent, same height as the spread */
.closed-book {
  width:min(500px,42vw); height:100%;
  position:relative;
  transform-origin:left center;
  border-radius:0 10px 10px 0;
  box-shadow:-6px 0 24px rgba(0,0,0,.55), 4px 4px 24px rgba(0,0,0,.4);
}

/* Opening keyframes — cover rotates out, spread fades in simultaneously */
@keyframes coverOpen {
  0%   { transform:perspective(1500px) translateX(0) rotateY(0deg);                        opacity:1; }
  60%  {                                                                                     opacity:1; }
  100% { transform:perspective(1500px) translateX(var(--openShiftX,0px)) rotateY(-105deg); opacity:0; }
}
@keyframes spreadReveal {
  0%   { opacity:0; transform:scale(.985); }
  40%  { opacity:.5; }
  65%  { opacity:1; transform:scale(1);   }
  100% { opacity:1; transform:scale(1);   }
}
.closed-book.opening {
  animation:coverOpen 700ms cubic-bezier(.42,0,.2,1) forwards;
}
.book-wrap.opening #book {
  animation:spreadReveal 700ms cubic-bezier(.42,0,.2,1) forwards;
}
.closed-spine {
  position:absolute; left:0; top:0; bottom:0; width:3px; z-index:2;
  background:linear-gradient(to bottom,#c4a97a,#7a5c38,#c4a97a);
  box-shadow:0 0 6px rgba(0,0,0,.3);
}
.closed-face {
  position:absolute; inset:0; left:3px;
  background:linear-gradient(135deg,#5a2e10,#2e1508);
  border-radius:0 10px 10px 0;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:14px; padding:32px 20px;
}
.open-btn {
  margin-top:8px;
  background:linear-gradient(135deg,rgba(201,168,76,.18),rgba(201,168,76,.08));
  border:1px solid rgba(201,168,76,.5); color:var(--gold);
  padding:10px 28px; border-radius:30px;
  font-family:'Lato',sans-serif; font-size:.72rem; letter-spacing:.18em; text-transform:uppercase;
  cursor:pointer; transition:background .2s, transform .15s;
}
.open-btn:hover  { background:rgba(201,168,76,.3); transform:translateY(-2px) scale(1.03); }
.open-btn:active { transform:scale(.98); }

/* ── CROP MODAL ── */
.crop-overlay {
  position:fixed; inset:0; z-index:200;
  background:rgba(0,0,0,.72); backdrop-filter:blur(4px);
  display:none; align-items:center; justify-content:center; padding:20px;
}
.crop-overlay.open { display:flex; }
.crop-modal {
  background:#1e0d04; border:1px solid rgba(201,168,76,.35);
  border-radius:14px; padding:24px; display:flex; flex-direction:column; gap:18px;
  width:100%; max-width:520px; box-shadow:0 24px 60px rgba(0,0,0,.7);
}
.crop-modal-header { display:flex; align-items:center; justify-content:space-between; }
.crop-modal-title {
  font-family:'Playfair Display',serif; color:var(--cream);
  font-size:1rem; letter-spacing:.06em;
}
.crop-modal-close {
  width:32px; height:32px; background:rgba(201,168,76,.1);
  border:1px solid rgba(201,168,76,.3); color:var(--gold); border-radius:8px;
  cursor:pointer; display:flex; align-items:center; justify-content:center;
  font-size:.85rem; transition:background .15s;
}
.crop-modal-close:hover { background:rgba(201,168,76,.22); }
.crop-viewport {
  position:relative; overflow:hidden; border-radius:6px;
  border:1px solid rgba(201,168,76,.2);
  cursor:grab; align-self:center; max-width:100%; user-select:none; touch-action:none;
}
.crop-viewport:active { cursor:grabbing; }
.crop-viewport img {
  position:absolute; left:50%; top:50%;
  width:100%; height:100%; object-fit:cover;
  will-change:transform; backface-visibility:hidden;
  pointer-events:none; user-select:none;
  transform:translate(-50%,-50%);
}
.crop-controls {
  display:flex; align-items:center; gap:12px;
}
.crop-zoom-label {
  font-size:.62rem; letter-spacing:.12em; text-transform:uppercase;
  color:rgba(201,168,76,.6); flex-shrink:0;
}
#cropZoom { flex:1; accent-color:var(--gold); cursor:pointer; height:4px; }
#cropZoomVal {
  font-size:.7rem; color:var(--gold); min-width:3.6em; text-align:right;
  font-family:'Lato',sans-serif; letter-spacing:.04em;
}
.crop-footer { display:flex; justify-content:flex-end; gap:10px; }
.crop-btn {
  padding:9px 24px; border-radius:8px; cursor:pointer;
  font-family:'Lato',sans-serif; font-size:.75rem;
  letter-spacing:.1em; text-transform:uppercase;
  border:1px solid rgba(201,168,76,.4); color:var(--gold);
  background:rgba(201,168,76,.1); transition:background .15s, border-color .15s;
}
.crop-btn:hover { background:rgba(201,168,76,.22); border-color:var(--gold); }
.crop-btn.crop-apply { background:rgba(201,168,76,.2); border-color:rgba(201,168,76,.7); }
.crop-btn.crop-apply:hover { background:rgba(201,168,76,.35); }

