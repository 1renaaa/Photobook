<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Digital Photobook</title>
<link rel="icon" type="image/svg+xml" href="favicon1.svg">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<link rel="stylesheet" href="./styles.css">
</head>
<body class="mode-closed">

<h1 class="editor-only">✦ My Photobook ✦</h1>
<div class="book-wrap" style="position:relative;">
  <div id="closedView">
    <div class="closed-book" id="closedBook">
      <div class="closed-spine"></div>
      <div class="closed-face" id="closedFace"></div>
    </div>
  </div>
  <div class="book" id="book"></div>
  <button class="floating-tray-btn editor-only" onclick="openTray()" title="All Pages">
    <span class="tray-icon"><svg width="22" height="16" viewBox="0 0 22 16" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"><path d="M11 13V3C9 2 6 2 2 3v10c4-1 7-1 9 0z"/><path d="M11 13V3c2-1 5-1 9 0v10c-2-1-5-1-9 0z"/></svg></span>
    <span>All<br>Pages</span>
  </button>
  <div class="action-rail editor-only">
    <button class="rail-btn" onclick="addPages()" data-tooltip="Add page">＋</button>
    <button class="rail-btn" id="delBtn" onclick="deletePage()" data-tooltip="Delete page" disabled>
      <svg width="14" height="14" viewBox="0 0 13 14" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="1,4 12,4"/>
        <path d="M4.5 4V2.5h4V4"/>
        <path d="M2.5 4l.8 8h6.4l.8-8"/>
      </svg>
    </button>
  </div>
  <button class="share-btn editor-only" onclick="openShareModal()" title="Share">
    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 12v7a1 1 0 001 1h14a1 1 0 001-1v-7"/>
      <polyline points="16 6 12 2 8 6"/>
      <line x1="12" y1="2" x2="12" y2="15"/>
    </svg>
  </button>
</div>

<!-- Crop Modal -->
<div class="crop-overlay" id="cropOverlay">
  <div class="crop-modal">
    <div class="crop-modal-header">
      <span class="crop-modal-title">Reframe Photo</span>
      <button class="crop-modal-close" onclick="closeCropModal()">
        <svg width="11" height="11" viewBox="0 0 12 12" fill="none"><path d="M1 1L11 11M11 1L1 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      </button>
    </div>
    <div class="crop-viewport" id="cropViewport">
      <img id="cropImg" draggable="false" />
    </div>
    <div class="crop-controls">
      <span class="crop-zoom-label">Zoom</span>
      <input type="range" id="cropZoom" min="1" max="3" step="0.01" value="1" />
      <span id="cropZoomVal">1.00×</span>
    </div>
    <div class="crop-footer">
      <button class="crop-btn crop-cancel" onclick="closeCropModal()">Cancel</button>
      <button class="crop-btn crop-apply" onclick="applyCrop()">Apply</button>
    </div>
  </div>
</div>

<!-- Share Modal -->
<div class="share-overlay" id="shareOverlay" onclick="closeShareIfBg(event)">
  <div class="share-modal">
    <button class="share-close" onclick="closeShareModal()">✕</button>
    <h2>Share this book</h2>
    <div class="share-url-row">
      <input type="text" id="shareUrlInput" readonly onclick="shareInputClick()">
      <button class="share-copy-btn" id="shareCopyBtn" onclick="copyShareLink()">Copy Link</button>
    </div>
    <div class="share-helper" id="shareHelper">Anyone with this link can view your book.</div>
  </div>
</div>

<div class="controls editor-only">
  <button class="btn" id="prevBtn" onclick="go(-1)" disabled>◀ Prev</button>
  <div class="pg-indicator" id="ind">Cover</div>
  <button class="btn" id="nextBtn" onclick="go(1)">Next ▶</button>
  <input type="file" id="importInput" accept=".json" style="display:none" onchange="importBook(event)">
</div>
<div class="hint editor-only">← → keys • drag photos to swap • drag pages in tray to reorder</div>

<!-- Page Tray -->
<div class="tray-overlay" id="trayOverlay" onclick="closeTrayIfBg(event)">
  <div class="tray">
    <div class="tray-header">
      <h3>All Pages</h3>
      <button class="tray-close" onclick="closeTray()">✕</button>
    </div>
    <div class="tray-scroll" id="trayScroll"></div>
    <div class="tray-drag-hint">Drag thumbnails to reorder pages</div>
  </div>
</div>

<script src="./app.js" defer></script>
</body>
</html>
